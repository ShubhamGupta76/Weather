<div class="calendar-overlay" (click)="closeCalendar()" *ngIf="showCalendar()">
  <div class="calendar-container" (click)="$event.stopPropagation()">
    <div class="calendar-header">
      <button class="nav-button" (click)="previousMonth()" type="button">‹</button>
      <h2>{{ monthNames[currentDate().getMonth()] }} {{ currentDate().getFullYear() }}</h2>
      <button class="nav-button" (click)="nextMonth()" type="button">›</button>
    </div>
    
    <div class="calendar-grid">
      <div class="day-header" *ngFor="let day of daysOfWeek">{{ day }}</div>
      <div 
        *ngFor="let day of getDaysInMonth()"
        class="calendar-day"
        [class.today]="isToday(day)"
        [class.other-month]="!isCurrentMonth(day)"
        [class.holiday]="isHoliday(day)"
        [class.selected]="selectedDate() && day.getTime() === selectedDate()!.getTime()"
        (click)="selectDate(day)"
        [title]="isHoliday(day) ? isHoliday(day)!.name : ''"
      >
        <span class="day-number">{{ day.getDate() }}</span>
        <span class="holiday-indicator" *ngIf="isHoliday(day)">●</span>
      </div>
    </div>
    
    <!-- Weather Search Section -->
    <div class="weather-search-section" *ngIf="selectedDate()">
      <div class="selected-date-info">
        <h3>Selected Date: {{ getSelectedDateString() }}</h3>
        <div class="weather-search-form">
          <input 
            type="text" 
            [(ngModel)]="cityName" 
            placeholder="Enter city name to check weather"
            class="city-input"
            (keyup.enter)="searchWeather()"
          />
          <button class="search-weather-btn" (click)="searchWeather()" [disabled]="weatherLoading()" type="button">
            <span *ngIf="!weatherLoading()">Search</span>
            <span *ngIf="weatherLoading()">Loading...</span>
          </button>
        </div>
        <div class="weather-error" *ngIf="weatherError()">{{ weatherError() }}</div>
      </div>
      
      <!-- Weather Display -->
      <div class="weather-display" *ngIf="weatherData() && !weatherLoading()">
        <div class="weather-header">
          <h4>{{ weatherData()!.name || 'Weather' }}</h4>
          <span class="weather-date">{{ getSelectedDateString() }}</span>
        </div>
        <div class="weather-main">
          <div class="weather-icon-temp">
            <img 
              *ngIf="weatherData()!.weather[0].icon" 
              [src]="'http://openweathermap.org/img/wn/' + weatherData()!.weather[0].icon + '@2x.png'" 
              alt="Weather icon"
              class="weather-icon"
            />
            <div class="temp-display">
              <span class="temperature">{{ roundTemp(weatherData()!.main.temp) }}°C</span>
              <span class="feels-like" *ngIf="weatherData()!.main.feels_like !== undefined">
                Feels like {{ roundTemp(weatherData()!.main.feels_like!) }}°C
              </span>
            </div>
          </div>
          <div class="weather-description">
            {{ capitalize(weatherData()!.weather[0].description) }}
          </div>
        </div>
        <div class="weather-details">
          <div class="detail-item">
            <span class="detail-label">Humidity</span>
            <span class="detail-value">{{ weatherData()!.main.humidity }}%</span>
          </div>
          <div class="detail-item" *ngIf="weatherData()!.main.temp_min && weatherData()!.main.temp_max">
            <span class="detail-label">Min/Max</span>
            <span class="detail-value">
              {{ roundTemp(weatherData()!.main.temp_min!) }}° / {{ roundTemp(weatherData()!.main.temp_max!) }}°
            </span>
          </div>
          <div class="detail-item" *ngIf="weatherData()!.main.pressure">
            <span class="detail-label">Pressure</span>
            <span class="detail-value">{{ weatherData()!.main.pressure }} hPa</span>
          </div>
          <div class="detail-item" *ngIf="weatherData()!.wind?.speed">
            <span class="detail-label">Wind Speed</span>
            <span class="detail-value">{{ weatherData()!.wind!.speed }} m/s</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="holidays-list">
      <h3>Holidays this Month</h3>
      <div class="holiday-item" *ngFor="let holiday of getHolidaysForMonth()">
        <span class="holiday-date">{{ holiday.date.getDate() }} {{ monthNames[holiday.date.getMonth()] }}</span>
        <span class="holiday-name">{{ holiday.name }}</span>
        <span class="holiday-type" [class.national]="holiday.type === 'national'" 
              [class.religious]="holiday.type === 'religious'"
              [class.regional]="holiday.type === 'regional'">
          {{ holiday.type }}
        </span>
      </div>
      <p class="no-holidays" *ngIf="getHolidaysForMonth().length === 0">No holidays this month</p>
    </div>
    
    <button class="close-button" (click)="closeCalendar()" type="button">Close</button>
  </div>
</div>
